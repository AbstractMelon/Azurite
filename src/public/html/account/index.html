<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    <link rel="icon" type="image/x-icon" href="/assets/images/icon.ico">
    <link rel="stylesheet" href="/stylesheets/profilespage.css">
    <link rel="stylesheet" href="/stylesheets/root.css">
</head>
<body>
    <div id="header-container"></div>

    <div class="profile-container">
        <div class="search-bar">
            <form id="search-form" onsubmit="searchProfiles(event)">
                <input type="text" id="search-input" name="search" placeholder="Search profiles...">
                <button type="submit">Search</button>
            </form>
        </div>
        <div class="profile-grid" id="profile-grid">
        </div>
    </div>

    <script src="scripts/header.js" defer></script>
    
    <script>
        async function fetchAccounts() {
            try {
                const response = await fetch('/api/v1/getAccounts');
                if (!response.ok) {
                    throw new Error('Failed to fetch accounts');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching accounts:', error.message);
                return [];
            }
        }

        async function displayAccounts() {
            const accounts = await fetchAccounts();
            const profileGrid = document.getElementById('profile-grid');

            profileGrid.innerHTML = ''; 

            accounts.forEach(account => {
                const profileIcon = document.createElement('div');
                profileIcon.classList.add('profile-icon');

                const profileLink = document.createElement('a');
                profileLink.href = `/user/${account.username}`;
                profileLink.title = account.username;

                const profileImage = document.createElement('img');
                profileImage.src = account.profilePicture;
                profileImage.alt = account.username;

                profileLink.appendChild(profileImage);
                profileIcon.appendChild(profileLink);
                profileGrid.appendChild(profileIcon);
            });
        }

        async function searchProfiles(event) {
            event.preventDefault();
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const accounts = await fetchAccounts();
            const filteredAccounts = accounts.filter(account => account.username.toLowerCase().includes(searchTerm));
            displayFilteredAccounts(filteredAccounts);
        }

        function displayFilteredAccounts(filteredAccounts) {
            const profileGrid = document.getElementById('profile-grid');
            profileGrid.innerHTML = '';

            filteredAccounts.forEach(account => {
                const profileIcon = document.createElement('div');
                profileIcon.classList.add('profile-icon');

                const profileLink = document.createElement('a');
                profileLink.href = `/user/${account.username}`;
                profileLink.title = account.username;

                const profileImage = document.createElement('img');
                profileImage.src = account.profilePicture;
                profileImage.alt = account.username;

                profileLink.appendChild(profileImage);
                profileIcon.appendChild(profileLink);
                profileGrid.appendChild(profileIcon);
            });
        }

        displayAccounts();
    </script>
</body>
</html>
